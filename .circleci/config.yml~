version: 2
jobs:
  build:
    docker:
      - image: docker.retrieva.jp/voice_recognizer_circleci:0.5.0
        auth:
          username: circleci
          password: l4,ugpgrCt^tvxu-aN0fjka=

    steps:
      - checkout

      - run:
          name: Run autogen.sh
          command: ./autogen.sh
      - run: 
          name: Run configure
          command: CPPFLAGS=-I/opt/voice_recognizer/include LDFLAGS=-L/opt/voice_recognizer/lib ./configure

      - run:
          name: Run check-syle
          command: make check-style
      - run:
          name: Run make
          command: make
      - run:
          name: Run make check
          command: make check
